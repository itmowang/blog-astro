<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<meta name="generator" content="Astro v2.10.9">
<link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">

<!-- Canonical URL -->
<link rel="canonical" href="https://blog.loli.wang/blog/2024-05-03-prismanestapi/doc/">

<!-- Primary Meta Tags -->
<title>使用Nestjs + prisma 构建 REST API - 魔王の博客</title>

<meta name="title" content="使用Nestjs + prisma 构建 REST API - 魔王の博客">
<meta name="description" content="使用nestjs + prisma构建REST API">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://blog.loli.wang/blog/2024-05-03-prismanestapi/doc/">
<meta property="og:title" content="使用Nestjs + prisma 构建 REST API - 魔王の博客">
<meta property="og:description" content="使用nestjs + prisma构建REST API">
<meta property="og:image" content="http://img.blog.loli.wang/2024-05-03-prismaNestApi/14.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://blog.loli.wang/blog/2024-05-03-prismanestapi/doc/">
<meta property="twitter:title" content="使用Nestjs + prisma 构建 REST API - 魔王の博客">
<meta property="twitter:description" content="使用nestjs + prisma构建REST API">
<meta property="twitter:image" content="http://img.blog.loli.wang/2024-05-03-prismaNestApi/14.png">


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RH0BZRF88N"></script>

  <link rel="stylesheet" href="/_astro/about.a4624501.css" /><script type="module" src="/_astro/hoisted.12906087.js"></script></head>
  <body>
    <div id="app" class="main">
      <div class="sidebar"> 
    <div class="top-container" data-aos="fade-right">
        <div class="top-header-container">
            <a href="/" title="Mowang - Your bio" class="site-title-container"><img src="https://avatars.githubusercontent.com/u/137391282?v=4" alt="Mowang" class="site-logo">
                <h1 class="site-title">魔王の博客</h1></a>
            <div class="menu-btn">
                <div class="line"></div>
            </div>
        </div>
        <div>
            <a href="/" title="Blog" class="site-nav">
                        Blog
                    </a><a href="/life" title="Life" class="site-nav">
                        Life
                    </a><a href="/archive" title="Archive" class="site-nav">
                        Archive
                    </a><a href="/link" title="Link" class="site-nav">
                        Link
                    </a><a href="/about" title="About" class="site-nav">
                        About
                    </a><a href="https://github.com/itmowang" title="Github" class="site-nav">
                        Github
                    </a>
        </div>
    </div>
    <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
        <div class="social-container"></div>
        <div class="site-description">高兴的使用astro构建</div>
        <div class="site-footer">
            © 2024 YOUR NAME HERE. | <a href="/rss.xml" title="RSS" target="_blank" class="rss">RSS</a>
        </div>
    </div>
</div>
      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
    <h2 class="post-title">使用Nestjs + prisma 构建 REST API</h2>
    <div class="post-date">
        <time datetime="2024-05-03T15:27:24.000Z">2024-05-03 23:27</time>
    </div>
    <div class="post-share">
        <div class="postShare">
  <div>
    <div class="postShare-List">
      分享本文 :
      <a href="http://service.weibo.com/share/share.php?url=https://blog.loli.wang/blog/2024-05-03-prismanestapi/doc/&#38;title=使用Nestjs + prisma 构建 REST API - 魔王の博客&#38;pic=http://img.blog.loli.wang/2024-05-03-prismaNestApi/14.png" target="_blank">
        <i class="iconfont icon-xinlang" style="color:#ff763b"></i></a>
      <div class="wechat-container">
        <a href="#">
          <i id="wechatIcon" class="iconfont icon-weichat" style="color:#33b045"></i></a>
        <div class="wechat-dropdown" id="wechatDropdown">
          <p>分享到微信</p>
          <div id="qrcode"></div>
          <p>扫描二维码</p>
          <p>可在微信查看或分享至朋友圈。</p>
        </div>
      </div>
      <a href="https://connect.qq.com/widget/shareqq/index.html?url=https://blog.loli.wang/blog/2024-05-03-prismanestapi/doc/&#38;title=使用Nestjs + prisma 构建 REST API - 魔王の博客&#38;source=使用Nestjs + prisma 构建 REST API - 魔王の博客&#38;desc=高兴的使用astro构建&#38;pics=http://img.blog.loli.wang/2024-05-03-prismaNestApi/14.png" target="_blank">
        <i class="iconfont icon-QQ" style="color:#56b6e7"></i></a>
      <a href="" target="_blank">
        <i class="iconfont icon-facebook" style="color:#44619D"></i></a>
      <a href="" target="_blank">
        <i class="iconfont icon-fenxiang1" style="color:#33b045"></i></a>
    </div>
  </div>
</div>
    </div>
    <div class="feature-container" style="background-image: url('http://img.blog.loli.wang/2024-05-03-prismaNestApi/14.png');"></div>
    <div class="post-content">
        
            <h2 id="2024-年-5月-3日">2024 年 5月 3日</h2>
<p>难得的51假期,5天假期，本应该是好好去玩的一天，可惜没有什么地方可以去，并且还报了驾校正在练车，正好今天没有安排，正好熟悉下nestjs吧。</p>
<h3 id="使用nest-cli-安装nest空项目">使用nest cli 安装nest空项目</h3>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D"># 创建空的 nest 项目</span></span>
<span class="line"><span style="color: #B392F0">npx</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">@nestjs/cli</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">new</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;</span><span style="color: #9ECBFF">项目</span><span style="color: #E1E4E8">名</span><span style="color: #F97583">></span></span></code></pre>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/01.png" alt="切01"></p>
<p>启动正常</p>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/02.png" alt="切03"></p>
<h3 id="安装prisma-并初始化">安装prisma, 并初始化</h3>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D"># 安装prisma</span></span>
<span class="line"><span style="color: #B392F0">pnpm</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">install</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">-D</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">prisma</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 初始化prisma</span></span>
<span class="line"><span style="color: #B392F0">npx</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">prisma</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">init</span></span></code></pre>
<p>会增加一个prisma 的文件夹， 里面的schenma.prisma 是我们的数据库配置文件</p>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/03.png" alt="切03">
<img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/04.png" alt="切04"></p>
<h3 id="本地安装mysql">本地安装mysql</h3>
<p>比较常规，每个人情况不一样，我在这里使用的mysql</p>
<h3 id="配置env环境变量">配置env环境变量</h3>
<p>在初始化prisma的时候，会生成一个env的配置文件，使用env文件配置环境变量,如果你是用的其他的数据库参考文档
<a href="https://www.prisma.io/docs/orm/reference/connection-urls">https://www.prisma.io/docs/orm/reference/connection-urls</a></p>
<p>我这里使用的是mysql，先修改指定数据库然后修改env配置</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D">// prisma/schema.prisma</span></span>
<span class="line"><span style="color: #E1E4E8">datasource db {</span></span>
<span class="line"><span style="color: #E1E4E8">  provider </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"mysql"</span></span>
<span class="line"><span style="color: #E1E4E8">  url      </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">env</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"DATABASE_URL"</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">DATABASE_URL</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"DATABASE_URL="mysql://prisma:123456@localhost:3306/prisma"</span></span></code></pre>
<h3 id="增加数据模型">增加数据模型</h3>
<p>此处是定义了一个 Article的表 内有相关字段，以及字段代表的类型</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D">// prisma/schema.prisma</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">model Article {</span></span>
<span class="line"><span style="color: #E1E4E8">  id          Int      @id @</span><span style="color: #B392F0">default</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">autoincrement</span><span style="color: #E1E4E8">())</span></span>
<span class="line"><span style="color: #E1E4E8">  title       String   @unique</span></span>
<span class="line"><span style="color: #E1E4E8">  description String</span><span style="color: #F97583">?</span></span>
<span class="line"><span style="color: #E1E4E8">  body        String</span></span>
<span class="line"><span style="color: #E1E4E8">  published   Boolean  @</span><span style="color: #B392F0">default</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">false</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">  createdAt   DateTime @</span><span style="color: #B392F0">default</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">now</span><span style="color: #E1E4E8">())</span></span>
<span class="line"><span style="color: #E1E4E8">  updatedAt   DateTime @updatedAt</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<h3 id="第一次执行">第一次执行</h3>
<p>当你定义好数据模型后 我们需要执行一次指令 让数据库和prisma同步, 你也可以记录到package.json中的script指令中</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D"># 指令</span></span>
<span class="line"><span style="color: #B392F0">npx</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">prisma</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">migrate</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">dev</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">--name</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"init"</span></span></code></pre>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/05.png" alt="切05"></p>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/06.png" alt="切06"></p>
<p>执行成功后，这里可以看到我们的数据库内自动生成了，我们刚刚设置的模型。每次修改我们的数据库模型都要去生成一遍。</p>
<h3 id="增加默认数据填充数据库">增加默认数据填充数据库</h3>
<p>创建一个为 <strong>prisma/seed.ts</strong> 的文件，</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color: #6A737D">// prisma/seed.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { PrismaClient } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'@prisma/client'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// initialize Prisma Client</span></span>
<span class="line"><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">prisma</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PrismaClient</span><span style="color: #E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">main</span><span style="color: #E1E4E8">() {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D">// create two dummy articles</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">post1</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> prisma.article.</span><span style="color: #B392F0">upsert</span><span style="color: #E1E4E8">({</span></span>
<span class="line"><span style="color: #E1E4E8">    where: { title: </span><span style="color: #9ECBFF">'Prisma Adds Support for MongoDB'</span><span style="color: #E1E4E8"> },</span></span>
<span class="line"><span style="color: #E1E4E8">    update: {},</span></span>
<span class="line"><span style="color: #E1E4E8">    create: {</span></span>
<span class="line"><span style="color: #E1E4E8">      title: </span><span style="color: #9ECBFF">'Prisma Adds Support for MongoDB'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">      body: </span><span style="color: #9ECBFF">'Support for MongoDB has been one of the most requested features since the initial release of...'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">      description:</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"We are excited to share that today's Prisma ORM release adds stable support for MongoDB!"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">      published: </span><span style="color: #79B8FF">false</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    },</span></span>
<span class="line"><span style="color: #E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">post2</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> prisma.article.</span><span style="color: #B392F0">upsert</span><span style="color: #E1E4E8">({</span></span>
<span class="line"><span style="color: #E1E4E8">    where: { title: </span><span style="color: #9ECBFF">"What's new in Prisma? (Q1/22)"</span><span style="color: #E1E4E8"> },</span></span>
<span class="line"><span style="color: #E1E4E8">    update: {},</span></span>
<span class="line"><span style="color: #E1E4E8">    create: {</span></span>
<span class="line"><span style="color: #E1E4E8">      title: </span><span style="color: #9ECBFF">"What's new in Prisma? (Q1/22)"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">      body: </span><span style="color: #9ECBFF">'Our engineers have been working hard, issuing new releases with many improvements...'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">      description:</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'Learn about everything in the Prisma ecosystem and community from January to March 2022.'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">      published: </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    },</span></span>
<span class="line"><span style="color: #E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  console.</span><span style="color: #B392F0">log</span><span style="color: #E1E4E8">({ post1, post2 });</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// execute the main function</span></span>
<span class="line"><span style="color: #B392F0">main</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">  .</span><span style="color: #B392F0">catch</span><span style="color: #E1E4E8">((</span><span style="color: #FFAB70">e</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    console.</span><span style="color: #B392F0">error</span><span style="color: #E1E4E8">(e);</span></span>
<span class="line"><span style="color: #E1E4E8">    process.</span><span style="color: #B392F0">exit</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">  })</span></span>
<span class="line"><span style="color: #E1E4E8">  .</span><span style="color: #B392F0">finally</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> () </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">// close Prisma Client at the end</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> prisma.</span><span style="color: #B392F0">$disconnect</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>在package.json中添加, 该命令使用 npx prisma db seed 的时候会自动执行，这样数据库内就会自动增加2条数据</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #B392F0">npx</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">prisma</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">db</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">seed</span></span></code></pre>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"prisma"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"seed"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"ts-node prisma/seed.ts"</span></span>
<span class="line"><span style="color: #E1E4E8"> }</span></span></code></pre>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/07.png" alt="切06">
<img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/08.png" alt="切08"></p>
<h3 id="创建-prisma-服务">创建 Prisma 服务</h3>
<p>nest提供了一个直接使用cli生成模块和服务的指令</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #B392F0">npx</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">nest</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">generate</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">module</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">prisma</span></span>
<span class="line"><span style="color: #B392F0">npx</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">nest</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">generate</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">service</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">prisma</span></span></code></pre>
<h3 id="设置-swagger">设置 swagger</h3>
<p>Swagger是一个使用 API 规范记录 API 的工具。 Nest 有一个专门用于 Swagger 的模块。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D"># 安装@nestjs/swagger 和  swagger-ui-express</span></span>
<span class="line"><span style="color: #B392F0">pnpm</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">install</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">--save</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">@nestjs/swagger</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">swagger-ui-express</span></span></code></pre>
<p>在 <strong>main.ts</strong>中初始化 swagger</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { NestFactory } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'@nestjs/core'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { AppModule } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'./app.module'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { SwaggerModule, DocumentBuilder } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'@nestjs/swagger'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">bootstrap</span><span style="color: #E1E4E8">() {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">app</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> NestFactory.</span><span style="color: #B392F0">create</span><span style="color: #E1E4E8">(AppModule);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">config</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DocumentBuilder</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">    .</span><span style="color: #B392F0">setTitle</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'Median'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    .</span><span style="color: #B392F0">setDescription</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'The Median API description'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    .</span><span style="color: #B392F0">setVersion</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'0.1'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    .</span><span style="color: #B392F0">build</span><span style="color: #E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">document</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> SwaggerModule.</span><span style="color: #B392F0">createDocument</span><span style="color: #E1E4E8">(app, config);</span></span>
<span class="line"><span style="color: #E1E4E8">  SwaggerModule.</span><span style="color: #B392F0">setup</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'api'</span><span style="color: #E1E4E8">, app, document);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> app.</span><span style="color: #B392F0">listen</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">3000</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #B392F0">bootstrap</span><span style="color: #E1E4E8">();</span></span>
<span class="line"></span></code></pre>
<p>我们启动一下,可以看到 <strong>/api</strong> 加上路径后，swagger访问正常</p>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/09.png" alt="切08"></p>
<h3 id="生成-rest-资源">生成 REST 资源</h3>
<p>可以看到swagger虽然正常了 但是我们目前还没有任何的接口去供我们查阅api。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D"># 快速生成REST资源</span></span>
<span class="line"><span style="color: #B392F0">npx</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">nest</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">generate</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">resource</span></span></code></pre>
<p>使用指令可以快速帮我们生成<strong>REST</strong>资源，供我们修改使用，重新启动一下。可以看到出现了我们需要的REST接口资源</p>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/10.png" alt="切10"></p>
<h3 id="连接prisma-进行curd">连接prisma 进行CURD</h3>
<p>可以看到我们的api资源对应的，都是 <strong>@Body(),@Query()</strong> 等装饰器来生成这个API。</p>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/11.png" alt="切11"></p>
<p>但是要让 <strong>Swagger</strong> 访问到我们的<strong>prsima</strong> 进行<strong>CURD</strong>操作还需要一定的步骤,进入到我们的articles.module.ts文件，引入Prisma的模型.</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D">// src/articles/articles.module.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { Module } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'@nestjs/common'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { ArticlesService } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'./articles.service'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { ArticlesController } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'./articles.controller'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { PrismaModule } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'src/prisma/prisma.module'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">@</span><span style="color: #B392F0">Module</span><span style="color: #E1E4E8">({</span></span>
<span class="line"><span style="color: #E1E4E8">  controllers: [ArticlesController],</span></span>
<span class="line"><span style="color: #E1E4E8">  providers: [ArticlesService],</span></span>
<span class="line"><span style="color: #E1E4E8">  imports: [PrismaModule],</span></span>
<span class="line"><span style="color: #E1E4E8">})</span></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ArticlesModule</span><span style="color: #E1E4E8"> {}</span></span>
<span class="line"></span></code></pre>
<p>将 <strong>PrismaService</strong>注入到<strong>ArticlesService</strong> 中, 并且使用他来访问数据库，需要增加一个构造函数</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D">// src/articles/articles.service.ts</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { Injectable } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'@nestjs/common'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { CreateArticleDto } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'./dto/create-article.dto'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { UpdateArticleDto } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'./dto/update-article.dto'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { PrismaService } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'src/prisma/prisma.service'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">@</span><span style="color: #B392F0">Injectable</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ArticlesService</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">constructor</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">private</span><span style="color: #E1E4E8"> </span><span style="color: #FFAB70">prisma</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PrismaService</span><span style="color: #E1E4E8">) {}</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">//   ...CURD</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h3 id="更改一个测试接口用来测试">更改一个测试接口用来测试</h3>
<p>我只需要简单写一个接口，查询出表<strong>article</strong>所有数据。看看是否成功 。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D">// src/articles/articles.service.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { Injectable } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'@nestjs/common'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { CreateArticleDto } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'./dto/create-article.dto'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { UpdateArticleDto } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'./dto/update-article.dto'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { PrismaService } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'src/prisma/prisma.service'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">@</span><span style="color: #B392F0">Injectable</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ArticlesService</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">constructor</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">private</span><span style="color: #E1E4E8"> </span><span style="color: #FFAB70">prisma</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PrismaService</span><span style="color: #E1E4E8">) {}</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">create</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">createArticleDto</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">CreateArticleDto</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'This action adds a new article'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">findAll</span><span style="color: #E1E4E8">() {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">.prisma.article.</span><span style="color: #B392F0">findMany</span><span style="color: #E1E4E8">({});</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">findOne</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">id</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">`This action returns a #${</span><span style="color: #E1E4E8">id</span><span style="color: #9ECBFF">} article`</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">update</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">id</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">updateArticleDto</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">UpdateArticleDto</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">`This action updates a #${</span><span style="color: #E1E4E8">id</span><span style="color: #9ECBFF">} article`</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">remove</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">id</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">`This action removes a #${</span><span style="color: #E1E4E8">id</span><span style="color: #9ECBFF">} article`</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p><img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/12.png" alt="切12">
<img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/13.png" alt="切13">
<img src="http://img.blog.loli.wang/2024-05-03-prismaNestApi/14.png" alt="切14"></p>
<h3 id="相关文章">相关文章</h3>
<p><a href="https://www.prisma.io/blog/nestjs-prisma-rest-api-7D056s1BmOL0#introduction">Prsima 官网</a></p>
<p><a href="https://github.com/itmowang/prisma-nest-mysql-demo">Github编写的示例DEMO</a></p>
          
    </div>
    <div class="tag-container">
        <a href="/tags/nestjs" class="tag" title="nestjs">nestjs</a><a href="/tags/prisma" class="tag" title="prisma">prisma</a><a href="/tags/RESTAPI" class="tag" title="RESTAPI">RESTAPI</a>
    </div>
</div>
          <script src="https://utteranc.es/client.js" repo="itmowang/blog-astro" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
        </div>
      </div>
    </div>
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

<script type="application/javascript">
  AOS.init();
</script>
  </body></html>